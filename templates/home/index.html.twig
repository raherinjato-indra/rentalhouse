{% extends 'base.html.twig' %}

{% block title %}Hello BaseController!{% endblock %}

{% block body %}
<style>
  .example-wrapper {
    margin: 1em auto;
    max-width: 800px;
    width: 95%;
    font: 18px/1.5 sans-serif;
  }

  .example-wrapper code {
    background: #F5F5F5;
    padding: 2px 6px;
  }
</style>

<div class="example-wrapper">
    <h1>Hello {{ controller_name }}! ✅</h1>

    This friendly message is coming from:
    <ul>
        <li>Your controller at <code>C:/projet/houserental/src/Controller/BaseController.php</code></li>
        <li>Your template at <code>C:/projet/houserental/templates/base/index.html.twig</code></li>
    </ul>
</div>
{% endblock %}

{% block carouselle %}
<style>
  /* Conteneur flex */
  .search-bar-container {
    display: flex !important;
    align-items: center;
    gap: 10px;
  }

  /* Champ de texte */
  #search-input {
    flex: 1;
    padding: 8px;
    font-size: 16px;
    border: 1px solid #ccc;
    border-radius: 4px;
  }

  
  </style>
<div class="EngineSectionstyled__EngineSectionContainer-uuddou-0 hhrdVH">
          <div class="EngineSectionstyled__AgathaForm-uuddou-1 dHyGsK">
            <div class="SearchEnginestyled__MainContainer-ff40l9-0 WgEYE">
              <h1 class="SearchEnginestyled__WelcomeTitle-ff40l9-6 kMBzNi">Que cherchez-vous ?</h1>
              <div class="SearchEnginestyled__Quest-ff40l9-1 btSMcs">
                <div id="moteur-engine" data-tab="2" class="SearchEnginestyled__QuestContainer-ff40l9-2 bGznpc">
				  <div class="criterion CriterionListView active c-quest-tabs visible" id="agatha_quest">
					<span class="title"></span>
					<span class="description"></span>
					<div class="containerList">
					  <div class="itemList active">
						<input type="checkbox" name="quest" id="agatha_quest0" value="1" onclick="toggleOffer('agatha_quest0','agatha_quest1')" checked>
						<label for="agatha_quest0">Louer</label>
					  </div>
					  <div class="itemList active">
						<input type="checkbox" name="quest" id="agatha_quest1" value="2" onclick="toggleOffer('agatha_quest1','agatha_quest0')">
						<label for="agatha_quest1">Acheter</label>
					  </div>
					 
					</div>
					<span class="error invisible"></span>
				  </div>


<div class="criterion CriterionAutocompleteView active visible" id="agatha_autocomplete">
  <form id="search-form" autocomplete="off" class="slam-aui autocompleteUI">
    <div class="slam-aui-input-fake search-bar-container">
      <div class="slam-aui-tags"></div>
      <input autocomplete="off" type="text" id="search-input" name="query" placeholder="Dans quelle ville ? Quartier ?">
      <button type="button" id="search-button">Rechercher</button>
 </div>
    <div class="slam-aui-results" id="search-results" style="display: none;"></div>
  </form>
  <span class="error invisible" id="search-error"></span>
</div>






<form method="GET" action="{{ path('app_search') }}">
  <input type="number" name="budget_min" value="{{ app.request.get('budget_min') }}" placeholder="Prix minimum">
  <input type="number" name="budget_max" value="{{ app.request.get('budget_max') }}" placeholder="Prix maximum">
  <button type="submit">Rechercher</button>
  
</form>

				  <div class="criterion CriterionListView active  visible" id="agatha_biens">
					<span class="title"></span>
					<span class="description"></span>
					<div class="containerList">
					  <div class="itemList active">
						<input type="checkbox" name="biens" id="agatha_biens0" value="2">
						<label for="agatha_biens0">
						  <i class="fi fi-check"></i>Maison </label>
					  </div>
					  <div class="itemList active">
						<input type="checkbox" name="biens" id="agatha_biens1" value="1">
						<label for="agatha_biens1">
						  <i class="fi fi-check"></i>Appartement </label>
					  </div>
					  <div class="itemList active">
						<input type="checkbox" name="biens" id="agatha_biens2" value="more">
						<label for="agatha_biens2">
						  <i class="fi fi-plus"></i>
						</label>
					  </div>
					  <div class="itemList inactive">
						<input type="checkbox" name="biens" id="agatha_biens3" value="4">
						<label for="agatha_biens3">
						  <i class="fi fi-check"></i>Terrain </label>
					  </div>
					  <div class="itemList inactive">
						<input type="checkbox" name="biens" id="agatha_biens4" value="3">
						<label for="agatha_biens4">
						  <i class="fi fi-check"></i>Parking / Box </label>
					  </div>
					  <div class="itemList inactive">
						<input type="checkbox" name="biens" id="agatha_biens5" value="9">
						<label for="agatha_biens5">
						  <i class="fi fi-check"></i>Loft </label>
					  </div>
					  <div class="itemList inactive">
						<input type="checkbox" name="biens" id="agatha_biens6" value="14">
						<label for="agatha_biens6">
						  <i class="fi fi-check"></i>Hôtel particulier </label>
					  </div>
					  <div class="itemList inactive">
						<input type="checkbox" name="biens" id="agatha_biens7" value="13">
						<label for="agatha_biens7">
						  <i class="fi fi-check"></i>Chateau </label>
					  </div>
					  <div class="itemList inactive">
						<input type="checkbox" name="biens" id="agatha_biens8" value="12">
						<label for="agatha_biens8">
						  <i class="fi fi-check"></i>Batiment </label>
					  </div>
					  <div class="itemList inactive">
						<input type="checkbox" name="biens" id="agatha_biens9" value="11">
						<label for="agatha_biens9">
						  <i class="fi fi-check"></i>Immeuble </label>
					  </div>
					  <div class="itemList inactive">
						<input type="checkbox" name="biens" id="agatha_biens10" value="6">
						<label for="agatha_biens10">
						  <i class="fi fi-check"></i>Boutique </label>
					  </div>
					  <div class="itemList inactive">
						<input type="checkbox" name="biens" id="agatha_biens11" value="7">
						<label for="agatha_biens11">
						  <i class="fi fi-check"></i>Local commercial </label>
					  </div>
					  <div class="itemList inactive">
						<input type="checkbox" name="biens" id="agatha_biens12" value="8">
						<label for="agatha_biens12">
						  <i class="fi fi-check"></i>Bureau </label>
					  </div>
					  <div class="itemList inactive">
						<input type="checkbox" name="biens" id="agatha_biens13" value="less">
						<label for="agatha_biens13">
						  <i class="fi fi-chevron-up"></i>
						</label>
					  </div>
					</div>
					<span class="error invisible"></span>
				  </div>
				  <div class="criterion CriterionListView active c-quest-links visible" id="agatha_link">
					<span class="title"></span>
					<span class="description"></span>
					<div class="containerList">
					  <div class="itemList active">
						<input type="checkbox" name="link" id="agatha_link0" value="lien">
						<label for="agatha_link0">
						  <a class="search-more-criteria" href="#">Recherche avancée</a>
						</label>
					  </div>
					</div>
					<span class="error invisible"></span>
				  </div>
				  <div class="criterion CriterionListView active c-quest-actions visible" id="agatha_actionbuttons">
					<span class="title"></span>
					<span class="description"></span>
					<div class="containerList">
					  <div class="itemList active">
						<input type="checkbox" name="actionbuttons" id="agatha_actionbuttons0" value="deposer-acheter">
						<label for="agatha_actionbuttons0">
						  <a class="deposer-acheter" id="deposer-acheter" target="_blank" href="https://www.seloger.com/depot-annonce/vente">
							<span>Propriétaire ?</span> Déposez votre annonce </a>
						</label>
					  </div>
					  <div class="itemList inactive">
						<input type="checkbox" name="actionbuttons" id="agatha_actionbuttons1" value="deposer-louer">
						<label for="agatha_actionbuttons1">
						  <a class="deposer-louer" id="deposer-louer" target="_blank" href="https://www.seloger.com/depot-annonce/location">
							<span>Propriétaire ?</span> Déposez votre annonce </a>
						</label>
					  </div>
					  <div class="itemList active">
						<input type="checkbox" name="actionbuttons" id="agatha_actionbuttons2" value="rechercher">
						<label for="agatha_actionbuttons2">
						  <a class="c-quest-actions-search" href="javascript:;">Rechercher</a>
						</label>
					  </div>
					</div>
					<span class="error invisible"></span>
				  </div>
				</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const input = document.getElementById('search-input');
    const resultsBox = document.getElementById('search-results');
    const form = document.getElementById('search-form');
    const searchButton = document.getElementById('search-button'); // Nouveau bouton

    // Fonction commune pour lancer la redirection
    function handleSearch() {
        const firstResult = resultsBox.querySelector('.result-item');
        if (firstResult) {
            const id = firstResult.dataset.id;
            const type = firstResult.dataset.type;

            if (type === 'City') {
                window.location.href = `/city/${id}`;
            } else if (type === 'Quartier') {
                window.location.href = `/quartier/${id}`;
            } else {
                alert('Redirection non définie pour ce type');
            }
        } else {
            alert('Veuillez choisir une ville dans la liste');
        }
    }

    // Empêche le comportement par défaut du formulaire
    form.addEventListener('submit', function(event) {
        event.preventDefault();
    });

    // Recherche automatique à chaque saisie
    input.addEventListener('input', function () {
        const query = this.value.trim();

        if (query.length < 2) {
            resultsBox.style.display = 'none';
            resultsBox.innerHTML = '';
            return;
        }

        fetch(`/autocomplete?query=${encodeURIComponent(query)}`)
            .then(response => response.json())
            .then(data => {
                if (data.length > 0) {
                    resultsBox.style.display = 'block';
                    resultsBox.innerHTML = data.map(item => `
                        <div class="result-item" data-id="${item.id}" data-type="${item.type}">
                            ${item.name} <small style="color: #888;">(${item.type})</small>
                        </div>
                    `).join('');
                } else {
                    resultsBox.innerHTML = '<div class="result-item">Aucun résultat</div>';
                    resultsBox.style.display = 'block';
                }
            })
            .catch(error => {
                console.error(error);
                resultsBox.innerHTML = '<div class="result-item">Erreur de recherche</div>';
                resultsBox.style.display = 'block';
            });
    });

    // Clic sur un résultat
    document.addEventListener('click', function (e) {
        if (e.target.classList.contains('result-item')) {
            const name = e.target.textContent.trim();
            const id = e.target.dataset.id;
            const type = e.target.dataset.type;

            input.value = name;
            resultsBox.innerHTML = '';
            resultsBox.style.display = 'none';

            if (type === 'City') {
                window.location.href = `/city/${id}`;
            } else if (type === 'Quartier') {
                window.location.href = `/quartier/${id}`;
            } else {
                alert('Redirection non définie pour les quartiers');
            }
        } else {
            // Clic en dehors = ferme les résultats
            resultsBox.innerHTML = '';
            resultsBox.style.display = 'none';
        }
    });

    // Touche Entrée dans le champ de recherche
    input.addEventListener('keydown', function(event) {
        if (event.key === 'Enter') {
            event.preventDefault();
            handleSearch();
        }
    });

    // Clic sur le bouton "Rechercher"
    searchButton.addEventListener('click', function () {
        handleSearch();
    });
});
</script>

{% endblock %}