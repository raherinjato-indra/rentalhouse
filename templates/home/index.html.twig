{% extends 'base.html.twig' %}

{% block title %}Hello BaseController!{% endblock %}

{% block body %}
<style>
  .example-wrapper {
    margin: 1em auto;
    max-width: 800px;
    width: 95%;
    font: 18px/1.5 sans-serif;
  }

  .example-wrapper code {
    background: #F5F5F5;
    padding: 2px 6px;
  }
</style>

<div class="example-wrapper">
    <h1>Hello {{ controller_name }}! ✅</h1>

    This friendly message is coming from:
    <ul>
        <li>Your controller at <code>C:/projet/houserental/src/Controller/BaseController.php</code></li>
        <li>Your template at <code>C:/projet/houserental/templates/base/index.html.twig</code></li>
    </ul>
</div>
{% endblock %}

{% block carouselle %}
<style>
  /* Conteneur flex */
  .search-bar-container {
    display: flex !important;
    align-items: center;
    gap: 10px;
  }

  /* Champ de texte */
  #search-input {
    flex: 1;
    padding: 8px;
    font-size: 16px;
    border: 1px solid #ccc;
    border-radius: 4px;
  }

  
  </style>
<div class="EngineSectionstyled__EngineSectionContainer-uuddou-0 hhrdVH">
          <div class="EngineSectionstyled__AgathaForm-uuddou-1 dHyGsK">
            <div class="SearchEnginestyled__MainContainer-ff40l9-0 WgEYE">
              <h1 class="SearchEnginestyled__WelcomeTitle-ff40l9-6 kMBzNi">Que cherchez-vous ?</h1>
              <div class="SearchEnginestyled__Quest-ff40l9-1 btSMcs">
                <div id="moteur-engine" data-tab="2" class="SearchEnginestyled__QuestContainer-ff40l9-2 bGznpc">
				  <div class="criterion CriterionListView active c-quest-tabs visible" id="agatha_quest">
					<span class="title"></span>
					<span class="description"></span>
					<div class="containerList">
					  <div class="itemList active">
						<input type="checkbox" name="quest" id="agatha_quest0" value="1" onclick="toggleOffer('agatha_quest0','agatha_quest1')" checked>
						<label for="agatha_quest0">Louer</label>
					  </div>
					  <div class="itemList active">
						<input type="checkbox" name="quest" id="agatha_quest1" value="2" onclick="toggleOffer('agatha_quest1','agatha_quest0')">
						<label for="agatha_quest1">Acheter</label>
					  </div>
					 
					</div>
					<span class="error invisible"></span>
				  </div>


<div class="criterion CriterionAutocompleteView active visible" id="agatha_autocomplete">
  <form id="search-form" autocomplete="off" class="slam-aui autocompleteUI" action="{{ path('app_search') }}" method="GET">
    <div class="slam-aui-input-fake search-bar-container">
      <div class="slam-aui-tags"></div>

      <input
        type="text"
        name="query"
        id="search-input"
        placeholder="Dans quelle ville ? Quartier ?"
        value="{{ app.request.get('query')|e }}"
        autocomplete="off"
      >

      <!-- Champ caché pour stocker l'ID de la ville sélectionnée -->
      <input type="hidden" name="city" id="city-id" value="{{ app.request.get('city')|default('') }}">
    </div>

    <div class="slam-aui-results" id="search-results" style="display: none;"></div>

    <!-- CHAMPS BUDGET -->
    <input type="number" id="budget_min" name="budget_min" value="{{ app.request.get('budget_min') }}" placeholder="Prix minimum">
    <input type="number" id="budget_max" name="budget_max" value="{{ app.request.get('budget_max') }}" placeholder="Prix maximum">

    <!-- TYPES DE BIENS -->
    <div class="criterion CriterionListView active visible" id="agatha_biens">
      <span class="title"></span>
      <span class="description"></span>
      <div class="containerList">
        <div class="itemList active">
          <input type="checkbox" name="biens[]" class="biens-checkbox" id="agatha_biens0" value="2"
            {% if '2' in app.request.get('biens', []) %}checked{% endif %}>
          <label for="agatha_biens0"><i class="fi fi-check"></i>Maison</label>
        </div>
        <div class="itemList active">
          <input type="checkbox" name="biens[]" class="biens-checkbox" id="agatha_biens1" value="1"
            {% if '1' in app.request.get('biens', []) %}checked{% endif %}>
          <label for="agatha_biens1"><i class="fi fi-check"></i>Appartement</label>
        </div>
        <div class="itemList active">
          <input type="checkbox" name="biens[]" class="biens-checkbox" id="agatha_biens2" value="more"
            {% if 'more' in app.request.get('biens', []) %}checked{% endif %}>
          <label for="agatha_biens2"><i class="fi fi-plus"></i></label>
        </div>
        <div class="itemList inactive">
          <input type="checkbox" name="biens[]" class="biens-checkbox" id="agatha_biens3" value="4"
            {% if '4' in app.request.get('biens', []) %}checked{% endif %}>
          <label for="agatha_biens3"><i class="fi fi-check"></i>Terrain</label>
        </div>
      </div>
      <span class="error invisible"></span>
    </div>


    <!-- BOUTONS D'ACTIONS -->
    <div class="criterion CriterionListView active c-quest-actions visible" id="agatha_actionbuttons">
      <span class="title"></span>
      <span class="description"></span>
      <div class="containerList">
        <div class="itemList active">
          <label for="agatha_actionbuttons0">
            <a class="deposer-acheter" id="deposer-acheter" target="_blank" href="https://www.seloger.com/depot-annonce/vente">
              <span>Propriétaire ?</span> Déposez votre annonce
            </a>
          </label>
        </div>
        <div class="itemList inactive">
          <input type="checkbox" name="actionbuttons" id="agatha_actionbuttons1" value="deposer-louer">
          <label for="agatha_actionbuttons1">
            <a class="deposer-louer" id="deposer-louer" target="_blank" href="https://www.seloger.com/depot-annonce/location">
              <span>Propriétaire ?</span> Déposez votre annonce
            </a>
          </label>
        </div>
        <div class="itemList active">
          <label for="agatha_actionbuttons2">
            <a class="c-quest-actions-search disabled" href="javascript:;" id="search-button" aria-disabled="true" style="pointer-events:none; opacity:0.5;">Rechercher</a>
          </label>
        </div>
      </div>
      <span class="error invisible"></span>
    </div>
  </form>
  <span class="error invisible" id="search-error"></span>
</div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const input = document.getElementById('search-input');
    const resultsBox = document.getElementById('search-results');
    const form = document.getElementById('search-form');
    const searchButton = document.getElementById('search-button');
    const cityIdInput = document.getElementById('city-id');
    const budgetMin = document.getElementById('budget_min');
    const budgetMax = document.getElementById('budget_max');
    const biensCheckboxes = document.querySelectorAll('.biens-checkbox');

    function isAnyBienChecked() {
        return Array.from(biensCheckboxes).some(cb => cb.checked);
    }

    function allFieldsFilled() {
        const queryFilled = input.value.trim().length > 0;
        const budgetMinFilled = budgetMin.value.trim().length > 0;
        const budgetMaxFilled = budgetMax.value.trim().length > 0;
        const atLeastOneBienChecked = isAnyBienChecked();
        return queryFilled && budgetMinFilled && budgetMaxFilled && atLeastOneBienChecked;
    }

    function toggleSearchButton() {
        if (allFieldsFilled()) {
            searchButton.classList.remove('disabled');
            searchButton.style.pointerEvents = 'auto';
            searchButton.style.opacity = '1';
            searchButton.setAttribute('aria-disabled', 'false');
        } else {
            searchButton.classList.add('disabled');
            searchButton.style.pointerEvents = 'none';
            searchButton.style.opacity = '0.5';
            searchButton.setAttribute('aria-disabled', 'true');
        }
    }

    form.addEventListener('submit', function (event) {
        event.preventDefault();
    });

    input.addEventListener('input', function () {
        const query = this.value.trim();
        cityIdInput.value = '';
        toggleSearchButton();

        if (query.length < 2) {
            resultsBox.style.display = 'none';
            resultsBox.innerHTML = '';
            return;
        }

        fetch(`/autocomplete?query=${encodeURIComponent(query)}`)
            .then(response => response.json())
            .then(data => {
                if (data.length > 0) {
                    resultsBox.style.display = 'block';
                    resultsBox.innerHTML = data.map(item =>
                        `<div class="result-item" data-id="${item.id}" data-type="${item.type}">
                            ${item.name} <small style="color: #888;">(${item.type})</small>
                        </div>`
                    ).join('');
                } else {
                    resultsBox.innerHTML = '<div class="result-item">Aucun résultat</div>';
                    resultsBox.style.display = 'block';
                }
            })
            .catch(error => {
                console.error(error);
                resultsBox.innerHTML = '<div class="result-item">Erreur de recherche</div>';
                resultsBox.style.display = 'block';
            });
    });

    document.addEventListener('click', function (e) {
        if (e.target.classList.contains('result-item')) {
            const name = e.target.textContent.trim();
            const id = e.target.getAttribute('data-id');
            input.value = name;
            cityIdInput.value = id;
            resultsBox.innerHTML = '';
            resultsBox.style.display = 'none';
            toggleSearchButton();
        } else if (!input.contains(e.target)) {
            resultsBox.style.display = 'none';
        }
    });

    budgetMin.addEventListener('input', toggleSearchButton);
    budgetMax.addEventListener('input', toggleSearchButton);
    biensCheckboxes.forEach(cb => cb.addEventListener('change', toggleSearchButton));

    searchButton.addEventListener('click', function (e) {
        e.preventDefault();
        if (!searchButton.classList.contains('disabled')) {
            form.submit();
        }
    });

    toggleSearchButton();
});
</script>



{% endblock %}